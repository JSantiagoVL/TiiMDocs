openapi: 3.0.0
info:
  title: Dashboard
  version: '1.0'
  description: ''
servers:
  - url: 'http://localhost:3000/api/v1/dashboard'
    description: Localhost
  - url: 'https://api.gotiim.com/api/v1/dashboard'
    description: Production
  - description: Testing
    url: 'https://testingapi.gotiim.com/api/v1/dashboard'
paths:
  /operation-areas:
    post:
      summary: Create a new operation area
      tags:
        - OperationArea
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/operation-area.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/operation-area.v1.yaml
      description: |
        Create a new operation area

        Responses:
         * 201 Created. Return the created driver.
         * 500 ERROR. Something went wrong.

        Operation:

          1. Clear the id from the request body if any.
          2. Validate that the new area is unique.
          3. Insert to DB.
          4. Return the created object.

        Notes: NA
      security:
        - JWT: []
    get:
      summary: Get list of all operation areas
      tags:
        - OperationArea
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../common/models/operation-area.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      requestBody:
        description: ''
      security:
        - JWT: []
      description: "Get list of all operation areas\n\nResponses:\n  * 200 OK.\n  * 500 ERROR. \n\nOperation:\n\n  1. Get and return all the operation areas.\n\nNotes: \n\n* NA\n"
    parameters: []
  '/operation-areas/{areaId}':
    parameters:
      - type: string
        name: areaId
        in: path
        required: true
    get:
      summary: Get a specific operation area
      tags:
        - OperationArea
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/operation-area.v1.yaml
      security:
        - JWT: []
      description: "Get a specific operation area\n\nResponses:\n * 200 OK. Return the list of buses.\n * 404 Not Found. The requested ID dosn't exists.\n * 500 ERROR. Something went wrong.\n\nOperation:\n\n  1. Try to get the requested ID from operation areas. If not coincidendes, response 404.\n  2. Return the requested data\n\nNotes: \n\n* NA"
    patch:
      summary: Update operation area data
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/operation-area.v1.yaml
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/operation-area.v1.yaml
      description: |-
        Update the operation area data

        RESPONSES:
         * 202 Accepted. Return the modifieded operation area
         * 404 Not found. Resource not found
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the operation area by pk. If not found return 404.
        2. Clear the id field if any.
        3. Validate that all the fields from the body belongs to the model.
        4. Update the values and save.
        5. Return the updated model.

        NOTES:

        NA
  '/routes/{routeId}':
    parameters:
      - type: string
        name: routeId
        in: path
        required: true
    get:
      summary: Get a specific route with full data
      tags:
        - Route
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/routes.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      security:
        - JWT: []
      description: |-
        Get a specific route

        RESPONSES:

         * 200 OK. Return the specific Route.
         * 404 Not Found. The requested resource dosn't exists.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find Route by pk
        2. Return the full route, include stops and trajectories

        NOTES:

        NA
    patch:
      summary: Update route core data
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/routes.v1.yaml
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/routes.v1.yaml
      description: |-
        Update Route model data

        RESPONSES:
         * 202 Accepted. Return the updated model.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the Route by pk.
        2. Clear the id field from body data, if any.
        3. Validate that all the fields from the body belongs to the model.
        4. Update the values and save.

        NOTES:

        * Is not expected to recive stops & trajectories in the body.
      operationId: Update route core data
  '/stops/{stopId}':
    parameters:
      - type: string
        name: stopId
        in: path
        required: true
    get:
      summary: Get a specific stop
      tags:
        - Stop
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/stop.v1.yaml
      security:
        - JWT: []
      requestBody: {}
      description: |
        Get a specific stop.

        RESPONSES:
         * 200 OK. Return the specifc Stop.
         * 404 Not Found. The requested ID dosn't exists.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find Stop by pk.
        2. Return the Stop model.

        NOTES:

        NA
      operationId: 'get-stops-{stopID}'
    patch:
      summary: Update the specific stop
      tags:
        - Stop
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/stop.v1.yaml
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/stop.v1.yaml
      description: |-
        Update the specific stop

        RESPONSES:
         * 202 Accepted. Return the updated Stop model.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the Stop by pk. Else, return 404.
        2. Verify that the id field from body data is the same as the path; else use the same as the path.
        3. Validate that all the fields from the body belongs to the model.
        4. Save the model and return the saved model.

        NOTES:

        !! Edit the seatsMask or seatNumeration fileds could cause unexpected errors on reservations and runs.
      operationId: 'patch-stops-{stopID}'
    delete:
      summary: Delete the specific stop
      tags:
        - Stop
      responses:
        '202':
          description: Accepted
      security:
        - JWT: []
  /vehicles:
    get:
      summary: Get the list of all vehicles models
      tags:
        - Vehicle
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../common/models/vehicle-model.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
            application/xml:
              schema:
                type: object
                properties: {}
      operationId: get-vehicle
      security:
        - JWT: []
      description: "Get the list of all vehicles models\n\nRESPONSES:\n\n * 200 OK. Return the list of all vehicles.\n * 500 ERROR. Something went wrong.\n\nOPERATION:\n\n1. Retrive all the vehicles from the list\n\nNOTES: \n\n* The operationAreaId filter dosn't apply here. Vehicles are a shared entity betwen all operation areas."
    post:
      summary: Create a new vehicle
      tags:
        - Vehicle
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/vehicle-model.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: post-vehicle
      description: "Insert a new vehicle in DB\n\nRESPONSES:\n * 201 CREATED. Return the created vehicle model.\n * 500 ERROR. Something went wrong\n\nOPERATION:\n\n1. Insert the new vehicle entity.\n2. Asociate the selected amenities to the new vehicle.\n3. Return the vehicle object.\n\nNOTES:\n\n * The ammenities need to be craeted first in order to select and asociate. \n * The models are global, independent from the operation area."
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/vehicle-model.v1.yaml
    parameters: []
  '/vehicles/{vehicleID}':
    parameters:
      - type: string
        name: vehicleID
        in: path
        required: true
    patch:
      summary: Update vehicle model data
      tags:
        - Vehicle
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/vehicle-model.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: 'patch-vehicle-{vehicleID}'
      description: |-
        Update vehicle model data

        RESPONSES:
         * 202 Accepted. Return the updated vehicle model.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the vehicle model by pk. Else, return 404.
        2. Verify that the id field from body data is the same as the path; else use the same as the path.
        3. Validate that all the fields from the body belongs to the model.
        4. Save the model and return the saved model.

        NOTES:

        !! Edit the seatsMask or seatNumeration fileds could cause unexpected errors on reservations and runs.
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/vehicle-model.v1.yaml
    get:
      summary: Get the specific vehicle
      operationId: 'get-vehicle-{vehicleID}'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/vehicle-model.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      description: |-
        Get the specific trajectory.

        RESPONSES:
         * 200 OK. Return the trajectory.
         * 404 Not Found. The requested ID dosn't exists.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find trajectory by pk.
        2. Return the trajectory.

        NOTES:

        NA
  /buses:
    post:
      summary: Create a new bus
      tags:
        - Bus
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/bus.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: post-buses
      description: |-
        Create a new bus

        RESPONSES:
         * 201 Created. Return the created bus.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Get the current operation area from the user data.
        2. Validate if the bus operationarea is the same as the user who made the request. If the user is superadmin, don't make the prev validation.
        3. Save the bus.
        4. Return the created object.

        NOTES:

        * The operation area validation could be ignored for now. Use the one from the body request.
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/bus.v1.yaml
    get:
      summary: Get the list of buses
      tags:
        - Bus
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../common/models/bus.v1.yaml
        '204':
          description: No Content
          content:
            application/json:
              schema:
                type: array
                items: {}
              examples:
                example-1:
                  value: []
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: get-buses
      description: |-
        Get the list of buses

        RESPONSES:
         * 200 OK. Return the list of buses.
         * 204 No content. If the query returns empty.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find all buses
        2. If the operationArea param is set, filter by area.
        3. Return the list of buses. If empty return 204 and an empty array.

        NOTES:

        NA
      security:
        - JWT: []
      requestBody:
        description: ''
      parameters:
        - schema:
            type: integer
          in: query
          name: operationAreaId
          description: Filter by operation area
  '/buses/{busID}':
    parameters:
      - type: string
        name: busID
        in: path
        required: true
        schema:
          type: integer
    patch:
      summary: Upadte the bus data
      tags:
        - Bus
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/bus.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: 'patch-buses-{busID}'
      description: |-
        Upadte the bus data

        RESPONSES:
         * 202 Accepted. Return the updated bus.
         * 404 Not found. Resource not found
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the bus by pk. If not found return 404.
        2. Clear the id field and operationArea from body data, if any.
        3. Validate that all the fields from the body belongs to the model.
        4. Update the values and save.
        5. Return the upadted model.

        NOTES:

        NA
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/bus.v1.yaml
        description: Any value from the object is suficcient. Except id.
    get:
      summary: Get the specific bus
      operationId: 'get-buses-{busID}'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/bus.v1.yaml
      description: |-
        Get the specific bus.

        RESPONSES:
         * 200 Ok. Return the bus.
         * 404 Not found. Resource not found
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the bus by pk. If not found return 404.
        5. Return the bus.

        NOTES:

        NA
      security:
        - JWT: []
  /drivers:
    get:
      summary: Get a list of drivers
      tags:
        - Drivers
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../common/models/driver.v1.yaml
        '204':
          description: No Content
          content:
            application/json:
              schema:
                type: array
                items: {}
              examples:
                example:
                  value: []
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/driver.v1.yaml
      operationId: get-drivers
      description: |-
        Get a list of drivers

        RESPONSES:
         * 200 OK. Return the list of drivers.
         * 204 No content. If the query returns empty.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Fin all drivers
        2. If the operationArea param is set filter by area.
        3. Return the list of drivers. If empty return 204 and an empty array.

        NOTES:

        NA
      security:
        - JWT: []
      requestBody: {}
      parameters:
        - schema:
            type: integer
          in: query
          name: operationAreaId
    post:
      summary: Create a driver
      tags:
        - Drivers
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/driver.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: post-drivers
      description: |
        Create a driver

        RESPONSES:
         * 201 Created. Return the created driver.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Get the current operation area from the user data.
        2. Validate if the driver operation area is the same as the user who made the request. If the user is superadmin, don't make the prev validation.
        3. Create the user inisde Firebase.
        5. Add the user type in the extended table of the user. tipo : CONDUCTOR.
        6. Return the created object.

        NOTES:

        * The operation area validation could be ignored for now. Use the one from the body request.
        * The firebase user is the same for userId inside the sql db.
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/driver.v1.yaml
  '/drivers/{driverID}':
    parameters:
      - type: string
        name: driverID
        in: path
        required: true
    patch:
      summary: Update the driver data
      tags: []
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/driver.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: 'patch-driver-{driverID}'
      description: |-
        Update the driver data

        RESPONSES:
         * 202 Accepted. Return the updated driver.
         * 404 Not found. Resource not found
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the driver by pk. If not found return 404.
        2. Clear the id field and operationArea from body data, if any.
        3. Validate that all the fields from the body belongs to the model.
        4. Update the values and save.
        5. Return the updated model.

        NOTES:

        NA
      security:
        - JWT: []
      parameters:
        - schema:
            type: integer
          in: query
          name: operationAreaId
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/driver.v1.yaml
        description: Any value from the object is suficcient. Except id.
    delete:
      summary: Delte a driver
      tags: []
      responses: {}
      operationId: 'delete-driver-{driverID}'
      description: |-
        Delte a driver (NOT DEVELOPED)

        RESPONSES:
         * 202 Accepted. Successfully deleted driver.
         * 404 Not found. Resource not found
         * 500 ERROR. Something went wrong.

        OPERATION:

        * SuperAdmin only
        1. Find the driver by pk. If not found return 404.
        2. Find all the runs associated to the driver.
        3. Find all the reservations associated to previous runs.
        4. Cancel all the previous reservations.
        5. Delete the driver.
        6. Return { "response": "DELETED" }.


        NOTES:

        * This action is a super admin only
    get:
      summary: Get the specific driver.
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/driver.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: 'get-driver-{driverID}'
      description: |-
        Get the specific driver.

        RESPONSES:
         * 200 Ok. Return the driver.
         * 404 Not found. Resource not found
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the driver by pk. If not found return 404.
        5. Return the driver.

        NOTES:

        NA
      security:
        - JWT: []
      requestBody: {}
  /routes/:
    get:
      summary: Get a list of routes
      tags:
        - Route
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/routes.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: get-routes
      description: "Get a list of routes\n\nRESPONSES:\n * 200 OK. Return a list of routes\n * 500 ERROR. Something went wrong\n\nOPERATION:\n\n1. Retrive all the routes.\n2. If the operationAreaId filter is set, filter by the operation area.\n3. Return the list of routes.\n\nNOTES: \n\n * The returned routes has only primary data, no stops array, no trajectories array."
      security:
        - JWT: []
      parameters:
        - schema:
            type: integer
            default: '1'
          in: query
          name: operationAreaId
          description: ''
    post:
      summary: Create a new route
      tags:
        - Route
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/routes.v1.yaml
      operationId: post-routes
      description: |-
        Create a new route.

        RESPONSES:
         * 201 CREATED. Return the created route.
         * 500 ERROR. Something went wrong

        OPERATION:

        1. Verify that the operationAreaId exists.
        2. Delete the id field if set.
        3. Before save, set the route status as: INACTIVE
        4. Return the created route.


        NOTES:

         * The new route is always set to be INACTIVE. It need to be manually activated once the stops an trajectories are ready.
         * Is not expected to recive stops & trajectories in the body.
  /stops:
    get:
      summary: Get a list of Stops
      tags:
        - Stop
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../common/models/stop.v1.yaml
        '500':
          description: Internal Server Error
      operationId: get-stop
      description: "Get a list of Stops\n\nRESPONSES:\n * 200 OK. Return a list of Stops\n * 500 ERROR. Something went wrong\n\nOPERATION:\n\n1. Retrive all the Stops.\n2. If the routeId or operationAreaId filter is set, filter by the specific. If both filters are set filter by routeId only.\n\n3. Return the list of Stops.\n\nNOTES: \n\nNA"
      security:
        - JWT: []
      requestBody: {}
      parameters:
        - schema:
            type: integer
          in: query
          name: operationAreaId
        - schema:
            type: integer
          in: query
          name: routeId
    post:
      summary: Create a new Stop
      tags:
        - Stop
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/stop.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: post-stop
      description: |-
        Create a new Stop.

        RESPONSES:
         * 201 CREATED. Return the created Stop.
         * 500 ERROR. Something went wrong

        OPERATION:

        1. Verify that the operationAreaId exists.
        2. Delete the id field if set.
        3. Set the nextStopId to be null.
        5. If prevStopId param is set and the prev stop exist in the same route, make an Insert after stop operation.
        6. Save the route.
        7. If the new stop is the last in the route, update the previous ending stop to point to the new stop.
        8. Return the created stop.

        NOTES:

         * The new Stop is always set to be ACTIVE.
         * The prevStopId param is optional
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/stop.v1.yaml
      parameters:
        - schema:
            type: integer
            default: '0'
          in: query
          name: prevStopId
    parameters: []
  '/stops/{stopId}/set-status':
    parameters:
      - type: string
        name: stopId
        in: path
        required: true
    patch:
      summary: Activate or deactivate the stop
      tags:
        - Stop
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: string
                    description: ok
              examples:
                example:
                  value:
                    response: ok
      operationId: patch-stops-stopId-active
      description: |
        Activate or deactivate the stop.


        RESPONSES:
         * 202 Accepted. Return the updated Stop model.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the Stop by pk. Else, return 404.
        2. If the stop status is diferent from the one in the body, continue, else return.
        3. Make the change status operation.
        4. Return {"response" : "ok"}

        NOTES:

        !! Edit the seatsMask or seatNumeration fileds could cause unexpected errors on reservations and runs.
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                isActive:
                  type: boolean
              required:
                - isActive
  /trajectories:
    get:
      summary: Get a list of trajectories
      tags:
        - Trajectory
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    trajectory:
                      $ref: ../common/models/trajectory.v1.yaml
                    aStopName:
                      type: string
                    bStopName:
                      type: string
        '500':
          description: Internal Server Error
      operationId: get-trajectories
      description: "Get a list of trajectories.\n\nRESPONSES:\n * 200 OK. Return a list of trajectories.\n * 500 ERROR. Something went wrong\n\nOPERATION:\n\n1. Retrive all the trajectories from the list and filter by the routeId query param.\n2. Return the list of trajectories.\n\nNOTES:  \n\nNA"
      security:
        - JWT: []
      parameters:
        - schema:
            type: integer
          in: query
          name: routeId
          required: true
    post:
      summary: Create a new trajectory
      tags:
        - Trajectory
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/trajectory.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: post-trajectories
      description: |-
        Create a new trajectory

        RESPONSES:

         * 201 CREATED. Return the created trajectory.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Delete the id param if set.
        2. Verify that a record with aStopId, bStopId and routeId dosn't exist in the DB. (Otherwise the DB will not allow an insert)
        3. Verify that the price and time params are set.
        4. Verify that the aStop and bStop params exist inside the route.
        5. Save and return the created trajectoy.

        NOTES:

        NA
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/trajectory.v1.yaml
          application/xml:
            schema:
              $ref: ../common/models/trajectory.v1.yaml
      security:
        - JWT: []
  '/trajectories/{trajectoryId}':
    parameters:
      - type: string
        name: trajectoryId
        in: path
        required: true
    patch:
      summary: Update the specific trajectory
      tags:
        - Trajectory
      responses: {}
      operationId: patch-trajectories-trajectoryId
      description: |-
        Update the specific trajectory.

        RESPONSES:

         * 202 Accepted. Return the updated trajectory.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the trajectory by pk. Else, return 404.
        2. The id, routeId, aStopId and bStopId params can't be modified.
        3. Validate that all the fields from the body belongs to the model.
        4. Save the model and return the saved model.

        NOTES:

        NA
    get:
      summary: Get the specific trajectory
      tags:
        - Trajectory
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/trajectory.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: get-trajectories-trajectoryId
      description: |-
        Get the specific trajectory.

        RESPONSES:
         * 200 OK. Return the trajectory.
         * 404 Not Found. The requested ID dosn't exists.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find trajectory by pk.
        2. Return the trajectory.

        NOTES:

        NA
      security:
        - JWT: []
  /runs/:
    get:
      summary: Get a Run
      tags:
        - Run
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    run:
                      $ref: ../common/models/run.v1.yaml
                    routeName:
                      type: string
                    busSerial:
                      type: string
                    driverName:
                      type: string
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: get-runs
      description: "Get a list of runs.\n\nRESPONSES:\n\n * 200 OK. Return a list of trajectories.\n * 500 ERROR. Something went wrong\n\nOPERATION:\n\n1. Retrive all the runs from the list.\n2. Filter by the operationAreaId query param and then, if set, filter by status.\n3. Return the list of runs.\n\nNOTES:  \n\nNA"
      security:
        - JWT: []
      parameters:
        - schema:
            type: integer
          in: query
          name: 'operationAreaId '
        - schema:
            type: string
            enum:
              - OPEN
              - IN_JOURNEY
              - ENDED
          in: query
          name: status
    post:
      summary: Create a new Run
      tags:
        - Run
      responses: {}
      operationId: post-runs
      description: |-
        Create a new Run

        RESPONSES:

         * 201 CREATED. Return the created Run.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Delete the id param if set.
        2. Verify that a record with routeId, stopId, busId, driverId and departureDate dosn't exist in the DB. Return error if a duplicate is found.
        3. Validate that the related entities exist. (Bus, driver, route).
        4. Validate that the departue date is a future date.
        5. Save and return the created Run.

        NOTES:

        The stop in the request body should be the ID of the source stop, not the whole Stop object.
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/run.v1.yaml
  '/run/{runID}':
    parameters:
      - type: string
        name: runID
        in: path
        required: true
    patch:
      summary: Update run data
      tags: []
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/run.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: patch-run-runID
      description: |-
        Update the specific Run data

        RESPONSES:
         * 202 Accepted. Return the updated Runmodel.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the Run by pk. Else, return 404.
        2. Delete the filed id if set.
        3. Only the bus and driver fields can be changed.
        4. Save the model and return the saved model.

        NOTES:

        If other field is needed to be changed, that run need to be canceled, and then create a new one. In case of cancelation all the reservations will be notified.
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/run.v1.yaml
    get:
      summary: Get a specific Run.
      operationId: get-run-runID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  run:
                    $ref: ../common/models/run.v1.yaml
                  driverName:
                    type: string
                  routeName:
                    type: string
                  busLicense:
                    type: string
                  busSerial:
                    type: string
                  reservations:
                    type: array
                    items:
                      $ref: ../common/models/reservation.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      description: "Get a specific Run.\n\nRESPONSES:\n * 200 OK. Return the specifc Run.\n * 404 Not Found. The requested ID dosn't exists.\n * 500 ERROR. Something went wrong.\n\nOPERATION:\n\n1. Find Run by pk.\n2. Get the associated models ( Route, Bus, Driver).\n3. Get the list of associated reservations whom status are one of: \n\n\nNOTES:\n\nNA\n"
      security:
        - JWT: []
  '/runs/{runID}/cancel':
    parameters:
      - type: string
        name: runID
        in: path
        required: true
    patch:
      summary: Cancel a specific Run
      tags: []
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: string
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: patch-runs-runID-cancel
      description: "Cancel a specific Run.\n\n\nRESPONSES:\n\n * 202 Accepted.\n * 404 Not Found. The referenced object coudn't be found.\n * 409 Conflict. Validations were invalid.\n * 500 ERROR. Something went wrong.\n\nOPERATION:\n\n1. Find the Run by pk. Else, return 404.\n2. Continue if the status is OPEN || CLOSED. Else, return 409\n3. Get the list of reservations associated to the run.\n4. For each reservation:\n    * If reservation.status = CONFIRMED && the time (Run.despartureDate - reservation.createdAt) < 30 min:\n      * Make a reimbursement as TiiM credits.\n      * Send push notification to the passenger device.\n      * Set the reservation status to: CANCELED_ADMIN.\n5. Set run status to: CANCELLED.    \n6. Return {\"response\" : \"ok\"}\n\nNOTES:\n\n* Check the flow diagrams for reimbursement procedure.\n* Check the notifications functions in order to send a push notification."
      security:
        - JWT: []
  /runs-planners:
    get:
      summary: Get the list of run planner
      tags:
        - Run-planner
        - Run
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ../common/models/run-planner.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: get-runs-planners
      description: "Get a list of Stops\n\nRESPONSES:\n * 200 OK. Return a list of Run-planners\n * 500 ERROR. Something went wrong\n\nOPERATION:\n\n1. Retrive all the Run-planners.\n2. Filter by operationAreaId if set, routeId if set. Else return all.\n3. Return the list of Run-planners.\n\nNOTES: \n\nNA"
      security:
        - JWT: []
      parameters:
        - schema:
            type: integer
          in: query
          name: operationAreaId
        - schema:
            type: integer
          in: query
          name: routeId
      requestBody: {}
    post:
      summary: Create a new run planner
      tags:
        - Run-planner
        - Run
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: ../common/models/run-planner.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: post-runs-planners
      description: |-
        Create a new Run-planner.

        RESPONSES:

         * 201 CREATED. Return the created object.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Delete the id param if set.
        2. Verify that a record with routeId, stopId, busId, departureTime, departureWeekDay dosn't exist in the DB. Return error if a duplicate is found.
        3. Validate that the related entities exist. (Bus, driver, route).
        5. Save and return the created Run-planner.

        NOTES:

        NA
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/run-planner.v1.yaml
    parameters: []
  '/runs-planners/{plannerID}':
    parameters:
      - type: string
        name: plannerID
        in: path
        required: true
    get:
      summary: Get a specific run planner.
      tags:
        - Run-planner
        - Run
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ../common/models/run-planner.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: get-runs-planners-plannerID
      security:
        - JWT: []
      description: |
        Get a specific stop.

        RESPONSES:
         * 200 OK. Return the specifc run planner.
         * 404 Not Found. The requested ID dosn't exists.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find run planner by pk.
        2. Return the run planner model.

        NOTES:

        NA
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/run-planner.v1.yaml
    patch:
      summary: Update a specific run planner data.
      tags:
        - Run-planner
        - Run
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: ../common/models/run-planner.v1.yaml
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: ../common/models/error.v1.yaml
      operationId: patch-runs-planners-plannerID
      description: |-
        Update a specific run planner data.

        RESPONSES:
         * 202 Accepted. Return the updated  Run-planner model.
         * 404 Not Found. The referenced object coudn't be found.
         * 500 ERROR. Something went wrong.

        OPERATION:

        1. Find the Run-planner by pk. Else, return 404.
        2. If id field is set, delete the field.
        3. Validate, only the bus and driver fields can be modifieded.
        4. Get all the runs that belong to the the Run-planner and departure date is on future.
        5. From the result, update the runs to have the same data.
        6. Return the updated Run-planner model

        NOTES:

        NA
      security:
        - JWT: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../common/models/run-planner.v1.yaml
components:
  schemas: {}
  securitySchemes:
    JWT:
      name: Bearer
      type: apiKey
      in: header
